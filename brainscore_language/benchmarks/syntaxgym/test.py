from pprint import pprint
from typing import List, Dict

import numpy as np
import pandas as pd
import pytest

from brainscore_language.artificial_subject import ArtificialSubject
from brainscore_language.benchmarks.syntaxgym import SyntaxGymSingleTSE
from brainscore_language.model_helpers.huggingface import HuggingfaceSubject


# Reference region surprisals computed with syntaxgym-core
# for various test suites.
# May include subsets of actual items for speed.
#
# See notebook in https://colab.research.google.com/drive/1qziyPcu65jffizSPi-ZGHKR0x7BaHFMS#scrollTo=RgtnScy6LLKi .
REFERENCE_DISTILGPT2_REGION_TOTALS = {
    "subordination_src-src": [
        {('sub_no-matrix', 1): 19.84858652913709,
        ('sub_no-matrix', 2): 38.27761140375277,
        ('sub_no-matrix', 3): 29.751378006746812,
        ('sub_no-matrix', 4): 47.65413128319506,
        ('sub_no-matrix', 5): 1.5145187795075914,
        ('no-sub_no-matrix', 1): 21.183614927141107,
        ('no-sub_no-matrix', 2): 37.427751739260216,
        ('no-sub_no-matrix', 3): 30.294518824193762,
        ('no-sub_no-matrix', 4): 48.05019176370221,
        ('no-sub_no-matrix', 5): 1.5036962552540964,
        ('sub_matrix', 1): 19.84858652913709,
        ('sub_matrix', 2): 38.27761140375277,
        ('sub_matrix', 3): 29.751378006746812,
        ('sub_matrix', 4): 47.65412715561145,
        ('sub_matrix', 5): 42.39613042087248,
        ('no-sub_matrix', 1): 21.183614927141107,
        ('no-sub_matrix', 2): 37.427751739260216,
        ('no-sub_matrix', 3): 30.294518824193762,
        ('no-sub_matrix', 4): 48.05020414645307,
        ('no-sub_matrix', 5): 48.51086651309947},
        {('sub_no-matrix', 1): 15.481061657043739,
        ('sub_no-matrix', 2): 20.541090323257418,
        ('sub_no-matrix', 3): 21.032507186474724,
        ('sub_no-matrix', 4): 21.510654556282063,
        ('sub_no-matrix', 5): 1.6935814401584692,
        ('no-sub_no-matrix', 1): 16.892056167795065,
        ('no-sub_no-matrix', 2): 18.94204688636498,
        ('no-sub_no-matrix', 3): 23.362924732356944,
        ('no-sub_no-matrix', 4): 21.192542546547394,
        ('no-sub_no-matrix', 5): 2.0879328430726654,
        ('sub_matrix', 1): 15.481061657043739,
        ('sub_matrix', 2): 20.541090323257418,
        ('sub_matrix', 3): 21.032507186474724,
        ('sub_matrix', 4): 21.510654556282063,
        ('sub_matrix', 5): 30.0925069705944,
        ('no-sub_matrix', 1): 16.892056167795065,
        ('no-sub_matrix', 2): 18.94204688636498,
        ('no-sub_matrix', 3): 23.362924732356944,
        ('no-sub_matrix', 4): 21.192542546547394,
        ('no-sub_matrix', 5): 34.16022583829358},
        {('sub_no-matrix', 1): 17.458578714557415,
        ('sub_no-matrix', 2): 44.434026029563846,
        ('sub_no-matrix', 3): 23.76181615478645,
        ('sub_no-matrix', 4): 52.25378930833386,
        ('sub_no-matrix', 5): 3.098146723472592,
        ('no-sub_no-matrix', 1): 17.20280267654123,
        ('no-sub_no-matrix', 2): 45.41114477251028,
        ('no-sub_no-matrix', 3): 24.130059021957983,
        ('no-sub_no-matrix', 4): 52.415132940431654,
        ('no-sub_no-matrix', 5): 3.374929754361067,
        ('sub_matrix', 1): 17.458578714557415,
        ('sub_matrix', 2): 44.434026029563846,
        ('sub_matrix', 3): 23.76181615478645,
        ('sub_matrix', 4): 52.25378930833386,
        ('sub_matrix', 5): 28.35409464085287,
        ('no-sub_matrix', 1): 17.20280267654123,
        ('no-sub_matrix', 2): 45.41114477251028,
        ('no-sub_matrix', 3): 24.130059021957983,
        ('no-sub_matrix', 4): 52.415132940431654,
        ('no-sub_matrix', 5): 29.672878159595665},
        {('sub_no-matrix', 1): 17.88796779896659,
        ('sub_no-matrix', 2): 54.61975407730992,
        ('sub_no-matrix', 3): 24.482945063783852,
        ('sub_no-matrix', 4): 32.95154483871123,
        ('sub_no-matrix', 5): 3.0266738294617244,
        ('no-sub_no-matrix', 1): 17.74169449061596,
        ('no-sub_no-matrix', 2): 52.93976150234407,
        ('no-sub_no-matrix', 3): 24.55781392721866,
        ('no-sub_no-matrix', 4): 34.741309554165205,
        ('no-sub_no-matrix', 5): 1.7552664575434327,
        ('sub_matrix', 1): 17.88796779896659,
        ('sub_matrix', 2): 54.61975407730992,
        ('sub_matrix', 3): 24.482945063783852,
        ('sub_matrix', 4): 32.95154999819075,
        ('sub_matrix', 5): 26.49159734446178,
        ('no-sub_matrix', 1): 17.74169449061596,
        ('no-sub_matrix', 2): 52.93976150234407,
        ('no-sub_matrix', 3): 24.55781392721866,
        ('no-sub_matrix', 4): 34.74130092278592,
        ('no-sub_matrix', 5): 30.13520682315062},
        {('sub_no-matrix', 1): 28.40811284364502,
        ('sub_no-matrix', 2): 30.774620432862854,
        ('sub_no-matrix', 3): 30.953590222882262,
        ('sub_no-matrix', 4): 30.672586393776314,
        ('sub_no-matrix', 5): 4.813360313439236,
        ('no-sub_no-matrix', 1): 32.95567740982881,
        ('no-sub_no-matrix', 2): 30.49579012049851,
        ('no-sub_no-matrix', 3): 32.08415326278971,
        ('no-sub_no-matrix', 4): 31.28184181376385,
        ('no-sub_no-matrix', 5): 3.1110602127952767,
        ('sub_matrix', 1): 28.40811284364502,
        ('sub_matrix', 2): 30.774620432862854,
        ('sub_matrix', 3): 30.953590222882262,
        ('sub_matrix', 4): 30.672586393776314,
        ('sub_matrix', 5): 38.83770360519069,
        ('no-sub_matrix', 1): 32.95567740982881,
        ('no-sub_matrix', 2): 30.49579012049851,
        ('no-sub_matrix', 3): 32.08415326278971,
        ('no-sub_matrix', 4): 31.28184181376385,
        ('no-sub_matrix', 5): 42.83607193078196},
        {('sub_no-matrix', 1): 20.154073120489265,
        ('sub_no-matrix', 2): 30.172181545242267,
        ('sub_no-matrix', 3): 25.562914763408436,
        ('sub_no-matrix', 4): 29.54087003821218,
        ('sub_no-matrix', 5): 3.5408751262479874,
        ('no-sub_no-matrix', 1): 20.996927071698927,
        ('no-sub_no-matrix', 2): 30.329587290583248,
        ('no-sub_no-matrix', 3): 26.868092304684843,
        ('no-sub_no-matrix', 4): 30.128514806222896,
        ('no-sub_no-matrix', 5): 2.0285295195166984,
        ('sub_matrix', 1): 20.154073120489265,
        ('sub_matrix', 2): 30.172181545242267,
        ('sub_matrix', 3): 25.562914763408436,
        ('sub_matrix', 4): 29.54087003821218,
        ('sub_matrix', 5): 58.487986484654996,
        ('no-sub_matrix', 1): 20.996927071698927,
        ('no-sub_matrix', 2): 30.329587290583248,
        ('no-sub_matrix', 3): 26.868092304684843,
        ('no-sub_matrix', 4): 30.128514806222896,
        ('no-sub_matrix', 5): 62.33690317651638},
        {('sub_no-matrix', 1): 18.542096244286643,
        ('sub_no-matrix', 2): 39.8330400403864,
        ('sub_no-matrix', 3): 26.94842264918045,
        ('sub_no-matrix', 4): 48.0418985452993,
        ('sub_no-matrix', 5): 3.3899132268695364,
        ('no-sub_no-matrix', 1): 19.875457098507894,
        ('no-sub_no-matrix', 2): 41.05056576373733,
        ('no-sub_no-matrix', 3): 27.56687828107589,
        ('no-sub_no-matrix', 4): 47.62817914417553,
        ('no-sub_no-matrix', 5): 2.7966109175760363,
        ('sub_matrix', 1): 18.542096244286643,
        ('sub_matrix', 2): 39.8330400403864,
        ('sub_matrix', 3): 26.94842264918045,
        ('sub_matrix', 4): 48.0418985452993,
        ('sub_matrix', 5): 38.41174987423249,
        ('no-sub_matrix', 1): 19.875457098507894,
        ('no-sub_matrix', 2): 41.05056576373733,
        ('no-sub_matrix', 3): 27.56687828107589,
        ('no-sub_matrix', 4): 47.62817914417553,
        ('no-sub_matrix', 5): 39.380539497397656},
        {('sub_no-matrix', 1): 22.058236137756936,
        ('sub_no-matrix', 2): 59.756337208919504,
        ('sub_no-matrix', 3): 30.511204925495342,
        ('sub_no-matrix', 4): 55.01269470653908,
        ('sub_no-matrix', 5): 1.465839606128826,
        ('no-sub_no-matrix', 1): 23.56970497693413,
        ('no-sub_no-matrix', 2): 59.835000009632346,
        ('no-sub_no-matrix', 3): 31.51849114522963,
        ('no-sub_no-matrix', 4): 54.874384280914725,
        ('no-sub_no-matrix', 5): 1.4070206796204912,
        ('sub_matrix', 1): 22.058236137756936,
        ('sub_matrix', 2): 59.756337208919504,
        ('sub_matrix', 3): 30.511204925495342,
        ('sub_matrix', 4): 55.012681979822915,
        ('sub_matrix', 5): 40.21390851942091,
        ('no-sub_matrix', 1): 23.56970497693413,
        ('no-sub_matrix', 2): 59.835000009632346,
        ('no-sub_matrix', 3): 31.51849114522963,
        ('no-sub_matrix', 4): 54.874387634576415,
        ('no-sub_matrix', 5): 45.11965086161496},
        {('sub_no-matrix', 1): 20.208583365645538,
        ('sub_no-matrix', 2): 32.71071151331525,
        ('sub_no-matrix', 3): 23.929238664163798,
        ('sub_no-matrix', 4): 36.27710164167995,
        ('sub_no-matrix', 5): 2.3424855684932644,
        ('no-sub_no-matrix', 1): 22.040704914258587,
        ('no-sub_no-matrix', 2): 32.724291263427375,
        ('no-sub_no-matrix', 3): 24.517287763386697,
        ('no-sub_no-matrix', 4): 35.637334951585494,
        ('no-sub_no-matrix', 5): 3.1888551890518615,
        ('sub_matrix', 1): 20.208583365645538,
        ('sub_matrix', 2): 32.71071151331525,
        ('sub_matrix', 3): 23.929238664163798,
        ('sub_matrix', 4): 36.27709957788814,
        ('sub_matrix', 5): 53.605858478311646,
        ('no-sub_matrix', 1): 22.040704914258587,
        ('no-sub_matrix', 2): 32.724291263427375,
        ('no-sub_matrix', 3): 24.517287763386697,
        ('no-sub_matrix', 4): 35.637334951585494,
        ('no-sub_matrix', 5): 57.65807396994879},
        {('sub_no-matrix', 1): 19.235979511249543,
        ('sub_no-matrix', 2): 29.229340836421937,
        ('sub_no-matrix', 3): 30.48163268066213,
        ('sub_no-matrix', 4): 33.534677813859204,
        ('sub_no-matrix', 5): 3.453748027390285,
        ('no-sub_no-matrix', 1): 19.29213597433987,
        ('no-sub_no-matrix', 2): 29.560537974164852,
        ('no-sub_no-matrix', 3): 30.8270084980988,
        ('no-sub_no-matrix', 4): 34.09155505761322,
        ('no-sub_no-matrix', 5): 4.115376980079769,
        ('sub_matrix', 1): 19.235979511249543,
        ('sub_matrix', 2): 29.229340836421937,
        ('sub_matrix', 3): 30.48163268066213,
        ('sub_matrix', 4): 33.534677813859204,
        ('sub_matrix', 5): 31.08725943869911,
        ('no-sub_matrix', 1): 19.29213597433987,
        ('no-sub_matrix', 2): 29.560537974164852,
        ('no-sub_matrix', 3): 30.8270084980988,
        ('no-sub_matrix', 4): 34.09155505761322,
        ('no-sub_matrix', 5): 38.23530109190076},
        {('sub_no-matrix', 1): 20.368089707084152,
        ('sub_no-matrix', 2): 49.25627457838232,
        ('sub_no-matrix', 3): 27.831169868066894,
        ('sub_no-matrix', 4): 40.37500888205905,
        ('sub_no-matrix', 5): 2.651787079006879,
        ('no-sub_no-matrix', 1): 22.02301684258265,
        ('no-sub_no-matrix', 2): 48.816563439233654,
        ('no-sub_no-matrix', 3): 29.33092944044274,
        ('no-sub_no-matrix', 4): 43.41645344149012,
        ('no-sub_no-matrix', 5): 3.236936378753577,
        ('sub_matrix', 1): 20.368089707084152,
        ('sub_matrix', 2): 49.25627457838232,
        ('sub_matrix', 3): 27.831169868066894,
        ('sub_matrix', 4): 40.37500888205905,
        ('sub_matrix', 5): 37.53002449026615,
        ('no-sub_matrix', 1): 22.02301684258265,
        ('no-sub_matrix', 2): 48.816563439233654,
        ('no-sub_matrix', 3): 29.33092944044274,
        ('no-sub_matrix', 4): 43.41645344149012,
        ('no-sub_matrix', 5): 41.495497436252926},
        {('sub_no-matrix', 1): 18.693022715239017,
        ('sub_no-matrix', 2): 32.35393178427385,
        ('sub_no-matrix', 3): 17.16735963193817,
        ('sub_no-matrix', 4): 33.140066410798106,
        ('sub_no-matrix', 5): 2.7831408923951595,
        ('no-sub_no-matrix', 1): 21.630230481791305,
        ('no-sub_no-matrix', 2): 31.841969357636522,
        ('no-sub_no-matrix', 3): 18.760749483148793,
        ('no-sub_no-matrix', 4): 34.65003788302557,
        ('no-sub_no-matrix', 5): 3.0621545382653252,
        ('sub_matrix', 1): 18.693022715239017,
        ('sub_matrix', 2): 32.35393178427385,
        ('sub_matrix', 3): 17.16735963193817,
        ('sub_matrix', 4): 33.140066410798106,
        ('sub_matrix', 5): 25.79307925254729,
        ('no-sub_matrix', 1): 21.630230481791305,
        ('no-sub_matrix', 2): 31.841969357636522,
        ('no-sub_matrix', 3): 18.760749483148793,
        ('no-sub_matrix', 4): 34.65003788302557,
        ('no-sub_matrix', 5): 29.401350735786},
        {('sub_no-matrix', 1): 23.349119910699418,
        ('sub_no-matrix', 2): 36.79505525594273,
        ('sub_no-matrix', 3): 27.448890271382062,
        ('sub_no-matrix', 4): 27.75725241265667,
        ('sub_no-matrix', 5): 6.4009658721533915,
        ('no-sub_no-matrix', 1): 25.37373717424875,
        ('no-sub_no-matrix', 2): 36.617579479211365,
        ('no-sub_no-matrix', 3): 27.65311554169803,
        ('no-sub_no-matrix', 4): 28.50976026573242,
        ('no-sub_no-matrix', 5): 3.7340522310725253,
        ('sub_matrix', 1): 23.349119910699418,
        ('sub_matrix', 2): 36.79505525594273,
        ('sub_matrix', 3): 27.448890271382062,
        ('sub_matrix', 4): 27.75725241265667,
        ('sub_matrix', 5): 43.75054754099549,
        ('no-sub_matrix', 1): 25.37373717424875,
        ('no-sub_matrix', 2): 36.617579479211365,
        ('no-sub_matrix', 3): 27.65311554169803,
        ('no-sub_matrix', 4): 28.50976026573242,
        ('no-sub_matrix', 5): 44.61412307986834},
        {('sub_no-matrix', 1): 18.45109196854789,
        ('sub_no-matrix', 2): 24.060699579747908,
        ('sub_no-matrix', 3): 26.564201712332675,
        ('sub_no-matrix', 4): 30.81202197289828,
        ('sub_no-matrix', 5): 2.2963507064513635,
        ('no-sub_no-matrix', 1): 17.20280267654123,
        ('no-sub_no-matrix', 2): 24.094664100250412,
        ('no-sub_no-matrix', 3): 27.832402983673582,
        ('no-sub_no-matrix', 4): 30.335879318860723,
        ('no-sub_no-matrix', 5): 1.7021960511401872,
        ('sub_matrix', 1): 18.45109196854789,
        ('sub_matrix', 2): 24.060699579747908,
        ('sub_matrix', 3): 26.564201712332675,
        ('sub_matrix', 4): 30.81202197289828,
        ('sub_matrix', 5): 40.518402942860256,
        ('no-sub_matrix', 1): 17.20280267654123,
        ('no-sub_matrix', 2): 24.094664100250412,
        ('no-sub_matrix', 3): 27.832402983673582,
        ('no-sub_matrix', 4): 30.335879318860723,
        ('no-sub_matrix', 5): 47.22794172102688},
        {('sub_no-matrix', 1): 21.58307008720231,
        ('sub_no-matrix', 2): 40.25998439141357,
        ('sub_no-matrix', 3): 27.037717417369624,
        ('sub_no-matrix', 4): 53.95255426259367,
        ('sub_no-matrix', 5): 6.407459937049971,
        ('no-sub_no-matrix', 1): 24.13069862543654,
        ('no-sub_no-matrix', 2): 39.806348676937795,
        ('no-sub_no-matrix', 3): 28.21254707178265,
        ('no-sub_no-matrix', 4): 52.36760893152307,
        ('no-sub_no-matrix', 5): 2.310403924801316,
        ('sub_matrix', 1): 21.58307008720231,
        ('sub_matrix', 2): 40.25998439141357,
        ('sub_matrix', 3): 27.037717417369624,
        ('sub_matrix', 4): 53.95256595741393,
        ('sub_matrix', 5): 48.12866878015645,
        ('no-sub_matrix', 1): 24.13069862543654,
        ('no-sub_matrix', 2): 39.806348676937795,
        ('no-sub_matrix', 3): 28.21254707178265,
        ('no-sub_matrix', 4): 52.36760893152307,
        ('no-sub_matrix', 5): 50.13949044999237},
        {('sub_no-matrix', 1): 21.749740537945264,
        ('sub_no-matrix', 2): 52.052811457427154,
        ('sub_no-matrix', 3): 18.66615145793761,
        ('sub_no-matrix', 4): 41.294273607159816,
        ('sub_no-matrix', 5): 2.207527514690852,
        ('no-sub_no-matrix', 1): 20.455624748789702,
        ('no-sub_no-matrix', 2): 51.89108430401795,
        ('no-sub_no-matrix', 3): 19.884462110107073,
        ('no-sub_no-matrix', 4): 42.374576093213825,
        ('no-sub_no-matrix', 5): 2.31318935581469,
        ('sub_matrix', 1): 21.749740537945264,
        ('sub_matrix', 2): 52.052811457427154,
        ('sub_matrix', 3): 18.66615145793761,
        ('sub_matrix', 4): 41.29429630886973,
        ('sub_matrix', 5): 35.2251669629595,
        ('no-sub_matrix', 1): 20.455624748789702,
        ('no-sub_matrix', 2): 51.89108430401795,
        ('no-sub_matrix', 3): 19.884462110107073,
        ('no-sub_matrix', 4): 42.374576093213825,
        ('no-sub_matrix', 5): 38.56545610077077},
        {('sub_no-matrix', 1): 22.700034802871336,
        ('sub_no-matrix', 2): 38.939772814729324,
        ('sub_no-matrix', 3): 25.22128171841117,
        ('sub_no-matrix', 4): 32.84511113945031,
        ('sub_no-matrix', 5): 3.0570659155915965,
        ('no-sub_no-matrix', 1): 24.47903916580011,
        ('no-sub_no-matrix', 2): 40.169493483887635,
        ('no-sub_no-matrix', 3): 26.33333460957155,
        ('no-sub_no-matrix', 4): 32.82603860743493,
        ('no-sub_no-matrix', 5): 3.5915728599999297,
        ('sub_matrix', 1): 22.700034802871336,
        ('sub_matrix', 2): 38.939772814729324,
        ('sub_matrix', 3): 25.22128171841117,
        ('sub_matrix', 4): 32.84511113945031,
        ('sub_matrix', 5): 31.485425760774746,
        ('no-sub_matrix', 1): 24.47903916580011,
        ('no-sub_matrix', 2): 40.169493483887635,
        ('no-sub_matrix', 3): 26.33333460957155,
        ('no-sub_matrix', 4): 32.82603860743493,
        ('no-sub_matrix', 5): 36.499637388885326},
        {('sub_no-matrix', 1): 19.271887424957885,
        ('sub_no-matrix', 2): 40.79664559050661,
        ('sub_no-matrix', 3): 26.810901623923552,
        ('sub_no-matrix', 4): 40.094853357378476,
        ('sub_no-matrix', 5): 6.078382829444246,
        ('no-sub_no-matrix', 1): 17.145941084582365,
        ('no-sub_no-matrix', 2): 42.24564895502921,
        ('no-sub_no-matrix', 3): 27.403583677786717,
        ('no-sub_no-matrix', 4): 39.54429974371404,
        ('no-sub_no-matrix', 5): 2.8781360255471844,
        ('sub_matrix', 1): 19.271887424957885,
        ('sub_matrix', 2): 40.79664559050661,
        ('sub_matrix', 3): 26.810901623923552,
        ('sub_matrix', 4): 40.094853357378476,
        ('sub_matrix', 5): 43.77389057421445,
        ('no-sub_matrix', 1): 17.145941084582365,
        ('no-sub_matrix', 2): 42.24564895502921,
        ('no-sub_matrix', 3): 27.403583677786717,
        ('no-sub_matrix', 4): 39.54429974371404,
        ('no-sub_matrix', 5): 52.64193467429601},
        {('sub_no-matrix', 1): 20.832624478093045,
        ('sub_no-matrix', 2): 36.50940755129819,
        ('sub_no-matrix', 3): 29.083164698269048,
        ('sub_no-matrix', 4): 49.64570143007171,
        ('sub_no-matrix', 5): 1.697204770646847,
        ('no-sub_no-matrix', 1): 25.069685375033682,
        ('no-sub_no-matrix', 2): 35.617647581593275,
        ('no-sub_no-matrix', 3): 30.66911784767371,
        ('no-sub_no-matrix', 4): 49.587663390789615,
        ('no-sub_no-matrix', 5): 1.963616731740342,
        ('sub_matrix', 1): 20.832624478093045,
        ('sub_matrix', 2): 36.50940755129819,
        ('sub_matrix', 3): 29.083164698269048,
        ('sub_matrix', 4): 49.64570143007171,
        ('sub_matrix', 5): 42.74057116863641,
        ('no-sub_matrix', 1): 25.069685375033682,
        ('no-sub_matrix', 2): 35.617647581593275,
        ('no-sub_matrix', 3): 30.66911784767371,
        ('no-sub_matrix', 4): 49.587663390789615,
        ('no-sub_matrix', 5): 46.617001988948125},
        {('sub_no-matrix', 1): 22.448761958585344,
        ('sub_no-matrix', 2): 32.15143459563375,
        ('sub_no-matrix', 3): 22.292358012185638,
        ('sub_no-matrix', 4): 46.77310135407315,
        ('sub_no-matrix', 5): 3.3833823576856723,
        ('no-sub_no-matrix', 1): 23.15318776204613,
        ('no-sub_no-matrix', 2): 31.538401404737364,
        ('no-sub_no-matrix', 3): 23.30091827939752,
        ('no-sub_no-matrix', 4): 45.351021013629854,
        ('no-sub_no-matrix', 5): 2.148098221754605,
        ('sub_matrix', 1): 22.448761958585344,
        ('sub_matrix', 2): 32.15143459563375,
        ('sub_matrix', 3): 22.292358012185638,
        ('sub_matrix', 4): 46.77310135407315,
        ('sub_matrix', 5): 42.947408167488376,
        ('no-sub_matrix', 1): 23.15318776204613,
        ('no-sub_matrix', 2): 31.538401404737364,
        ('no-sub_matrix', 3): 23.30091827939752,
        ('no-sub_matrix', 4): 45.351021013629854,
        ('no-sub_matrix', 5): 45.507769785244534},
        {('sub_no-matrix', 1): 19.73122556818831,
        ('sub_no-matrix', 2): 27.639846048288057,
        ('sub_no-matrix', 3): 28.083093150738456,
        ('sub_no-matrix', 4): 33.82243514369056,
        ('sub_no-matrix', 5): 2.2183565742850795,
        ('no-sub_no-matrix', 1): 20.0670925508501,
        ('no-sub_no-matrix', 2): 28.689049255551836,
        ('no-sub_no-matrix', 3): 28.262896024718646,
        ('no-sub_no-matrix', 4): 35.92639040646556,
        ('no-sub_no-matrix', 5): 1.909283112766509,
        ('sub_matrix', 1): 19.73122556818831,
        ('sub_matrix', 2): 27.639846048288057,
        ('sub_matrix', 3): 28.083093150738456,
        ('sub_matrix', 4): 33.82243514369056,
        ('sub_matrix', 5): 53.05216282760726,
        ('no-sub_matrix', 1): 20.0670925508501,
        ('no-sub_matrix', 2): 28.689049255551836,
        ('no-sub_matrix', 3): 28.262896024718646,
        ('no-sub_matrix', 4): 35.92639040646556,
        ('no-sub_matrix', 5): 58.56106948024324},
        {('sub_no-matrix', 1): 15.421868668269777,
        ('sub_no-matrix', 2): 54.27397435861769,
        ('sub_no-matrix', 3): 19.669065878686965,
        ('sub_no-matrix', 4): 25.491622666159284,
        ('sub_no-matrix', 5): 4.734922122068425,
        ('no-sub_no-matrix', 1): 16.0240858702534,
        ('no-sub_no-matrix', 2): 53.57980663235027,
        ('no-sub_no-matrix', 3): 20.270908244483035,
        ('no-sub_no-matrix', 4): 25.9813102008265,
        ('no-sub_no-matrix', 5): 3.89920510690427,
        ('sub_matrix', 1): 15.421868668269777,
        ('sub_matrix', 2): 54.27397435861769,
        ('sub_matrix', 3): 19.669065878686965,
        ('sub_matrix', 4): 25.491619914436868,
        ('sub_matrix', 5): 34.71751137683846,
        ('no-sub_matrix', 1): 16.0240858702534,
        ('no-sub_matrix', 2): 53.57980663235027,
        ('no-sub_matrix', 3): 20.270908244483035,
        ('no-sub_matrix', 4): 25.9813102008265,
        ('no-sub_matrix', 5): 41.833321597185034},
        {('sub_no-matrix', 1): 17.907130793856325,
        ('sub_no-matrix', 2): 31.11938278818389,
        ('sub_no-matrix', 3): 25.531152491499135,
        ('sub_no-matrix', 4): 46.53901611194908,
        ('sub_no-matrix', 5): 2.2405772487245073,
        ('no-sub_no-matrix', 1): 17.20280267654123,
        ('no-sub_no-matrix', 2): 30.99227574239337,
        ('no-sub_no-matrix', 3): 27.091719453792596,
        ('no-sub_no-matrix', 4): 47.86441244960888,
        ('no-sub_no-matrix', 5): 2.8696366429415443,
        ('sub_matrix', 1): 17.907130793856325,
        ('sub_matrix', 2): 31.11938278818389,
        ('sub_matrix', 3): 25.531152491499135,
        ('sub_matrix', 4): 46.53901611194908,
        ('sub_matrix', 5): 56.498433565285985,
        ('no-sub_matrix', 1): 17.20280267654123,
        ('no-sub_matrix', 2): 30.99227574239337,
        ('no-sub_matrix', 3): 27.091719453792596,
        ('no-sub_matrix', 4): 47.86441244960888,
        ('no-sub_matrix', 5): 60.744979821369654}
    ],

    "cleft_modifier": [
        {('np_mismatch', 1): 0.0,
        ('np_mismatch', 2): 11.057731854398419,
        ('np_mismatch', 3): 4.592643626732037,
        ('np_mismatch', 4): 53.03026872672399,
        ('np_mismatch', 5): 6.441552401895808,
        ('np_mismatch', 6): 0,
        ('np_mismatch', 7): 17.342469099376313,
        ('np_match', 1): 0.0,
        ('np_match', 2): 11.057731854398419,
        ('np_match', 3): 11.346476966585007,
        ('np_match', 4): 52.035723046259115,
        ('np_match', 5): 6.434656585526812,
        ('np_match', 6): 0,
        ('np_match', 7): 16.177578322356645,
        ('vp_match', 1): 0.0,
        ('vp_match', 2): 11.057731854398419,
        ('vp_match', 3): 4.592643626732037,
        ('vp_match', 4): 53.03026872672399,
        ('vp_match', 5): 6.441552401895808,
        ('vp_match', 6): 21.45446971605434,
        ('vp_match', 7): 15.280547084402789,
        ('vp_mismatch', 1): 0.0,
        ('vp_mismatch', 2): 11.057731854398419,
        ('vp_mismatch', 3): 11.346476966585007,
        ('vp_mismatch', 4): 52.035723046259115,
        ('vp_mismatch', 5): 6.434656585526812,
        ('vp_mismatch', 6): 22.268852971309567,
        ('vp_mismatch', 7): 15.17471377657604}
    ],

    "npz_ambig": [
        {('ambig_nocomma', 1): 19.327468872070312,
        ('ambig_nocomma', 2): 18.147207260131836,
        ('ambig_nocomma', 3): 0,
        ('ambig_nocomma', 4): 13.048900604248047,
        ('ambig_nocomma', 5): 15.911623001098633,
        ('ambig_nocomma', 6): 19.5185489654541,
        ('unambig_nocomma', 1): 19.327468872070312,
        ('unambig_nocomma', 2): 18.059558868408203,
        ('unambig_nocomma', 3): 0,
        ('unambig_nocomma', 4): 15.915300369262695,
        ('unambig_nocomma', 5): 17.007373809814453,
        ('unambig_nocomma', 6): 18.407306671142578,
        ('ambig_comma', 1): 19.327468872070312,
        ('ambig_comma', 2): 18.147207260131836,
        ('ambig_comma', 3): 4.558409214019775,
        ('ambig_comma', 4): 8.555574417114258,
        ('ambig_comma', 5): 9.404891014099121,
        ('ambig_comma', 6): 18.525285720825195,
        ('unambig_comma', 1): 19.327468872070312,
        ('unambig_comma', 2): 18.059558868408203,
        ('unambig_comma', 3): 4.463290214538574,
        ('unambig_comma', 4): 9.004743576049805,
        ('unambig_comma', 5): 10.577862739562988,
        ('unambig_comma', 6): 17.343650817871094},
    ],

    "number_orc": [
        {('match_sing', 1): 0.0,
        ('match_sing', 2): 17.81989706575509,
        ('match_sing', 3): 11.318308960096092,
        ('match_sing', 4): 4.072657865466654,
        ('match_sing', 5): 14.901647290772711,
        ('match_sing', 6): 14.294160540366649,
        ('match_sing', 7): 4.9884819916455925,
        ('match_sing', 8): 11.233594433864694,
        ('mismatch_sing', 1): 0.0,
        ('mismatch_sing', 2): 17.81989706575509,
        ('mismatch_sing', 3): 11.318308960096092,
        ('mismatch_sing', 4): 4.072657865466654,
        ('mismatch_sing', 5): 14.901647290772711,
        ('mismatch_sing', 6): 14.294160540366649,
        ('mismatch_sing', 7): 2.761540731360045,
        ('mismatch_sing', 8): 9.809722550147363,
        ('match_plural', 1): 0.0,
        ('match_plural', 2): 19.013682303980914,
        ('match_plural', 3): 11.53543155336556,
        ('match_plural', 4): 4.1619863422554,
        ('match_plural', 5): 14.695967047230447,
        ('match_plural', 6): 15.385013474120479,
        ('match_plural', 7): 7.708691680367637,
        ('match_plural', 8): 9.908711636400374,
        ('mismatch_plural', 1): 0.0,
        ('mismatch_plural', 2): 19.013682303980914,
        ('mismatch_plural', 3): 11.53543155336556,
        ('mismatch_plural', 4): 4.1619863422554,
        ('mismatch_plural', 5): 14.695967047230447,
        ('mismatch_plural', 6): 15.385013474120479,
        ('mismatch_plural', 7): 3.8243548175957582,
        ('mismatch_plural', 8): 9.90838968487796}
    ],

    "number_prep": [{('match_sing', 2): 17.819894790649414,
  ('match_sing', 3): 18.460590362548828,
  ('match_sing', 4): 2.225862503051758,
  ('match_sing', 5): 19.330965042114258,
  ('match_sing', 6): 3.4459455013275146,
  ('match_sing', 7): 14.691803932189941,
  ('mismatch_sing', 2): 17.819894790649414,
  ('mismatch_sing', 3): 18.460590362548828,
  ('mismatch_sing', 4): 2.225862503051758,
  ('mismatch_sing', 5): 19.330965042114258,
  ('mismatch_sing', 6): 5.87825345993042,
  ('mismatch_sing', 7): 13.547097206115723,
  ('match_plural', 2): 19.013675689697266,
  ('match_plural', 3): 19.52313232421875,
  ('match_plural', 4): 2.6633453369140625,
  ('match_plural', 5): 15.127424240112305,
  ('match_plural', 6): 3.2583653926849365,
  ('match_plural', 7): 13.393289566040039,
  ('mismatch_plural', 2): 19.013675689697266,
  ('mismatch_plural', 3): 19.52313232421875,
  ('mismatch_plural', 4): 2.6633453369140625,
  ('mismatch_plural', 5): 15.127424240112305,
  ('mismatch_plural', 6): 6.091649055480957,
  ('mismatch_plural', 7): 14.746828079223633,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 22.72154426574707,
  ('match_sing', 3): 10.64484977722168,
  ('match_sing', 4): 0.8734378218650818,
  ('match_sing', 5): 19.118059158325195,
  ('match_sing', 6): 15.924458503723145,
  ('match_sing', 7): 23.4847412109375,
  ('mismatch_sing', 2): 22.72154426574707,
  ('mismatch_sing', 3): 10.64484977722168,
  ('mismatch_sing', 4): 0.8734378218650818,
  ('mismatch_sing', 5): 19.118059158325195,
  ('mismatch_sing', 6): 15.668272972106934,
  ('mismatch_sing', 7): 23.874950408935547,
  ('match_plural', 2): 23.612194061279297,
  ('match_plural', 3): 10.203206062316895,
  ('match_plural', 4): 0.7124818563461304,
  ('match_plural', 5): 17.438419342041016,
  ('match_plural', 6): 14.02140998840332,
  ('match_plural', 7): 22.88547706604004,
  ('mismatch_plural', 2): 23.612194061279297,
  ('mismatch_plural', 3): 10.203206062316895,
  ('mismatch_plural', 4): 0.7124818563461304,
  ('mismatch_plural', 5): 17.438419342041016,
  ('mismatch_plural', 6): 17.666671752929688,
  ('mismatch_plural', 7): 22.918838500976562,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 21.18360710144043,
  ('match_sing', 3): 13.208681106567383,
  ('match_sing', 4): 1.9188281297683716,
  ('match_sing', 5): 12.694650650024414,
  ('match_sing', 6): 20.223880767822266,
  ('match_sing', 7): 8.506268501281738,
  ('mismatch_sing', 2): 21.18360710144043,
  ('mismatch_sing', 3): 13.208681106567383,
  ('mismatch_sing', 4): 1.9188281297683716,
  ('mismatch_sing', 5): 12.694650650024414,
  ('mismatch_sing', 6): 20.62624740600586,
  ('mismatch_sing', 7): 9.419041633605957,
  ('match_plural', 2): 20.924222946166992,
  ('match_plural', 3): 15.08077335357666,
  ('match_plural', 4): 1.4344865083694458,
  ('match_plural', 5): 13.017986297607422,
  ('match_plural', 6): 19.822303771972656,
  ('match_plural', 7): 7.673503875732422,
  ('mismatch_plural', 2): 20.924222946166992,
  ('mismatch_plural', 3): 15.08077335357666,
  ('mismatch_plural', 4): 1.4344865083694458,
  ('mismatch_plural', 5): 13.017986297607422,
  ('mismatch_plural', 6): 21.198131561279297,
  ('mismatch_plural', 7): 11.092202186584473,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 23.299219131469727,
  ('match_sing', 3): 9.742779731750488,
  ('match_sing', 4): 1.911871075630188,
  ('match_sing', 5): 23.28413963317871,
  ('match_sing', 6): 14.98054027557373,
  ('match_sing', 7): 12.56060791015625,
  ('mismatch_sing', 2): 23.299219131469727,
  ('mismatch_sing', 3): 9.742779731750488,
  ('mismatch_sing', 4): 1.911871075630188,
  ('mismatch_sing', 5): 23.28413963317871,
  ('mismatch_sing', 6): 14.859261512756348,
  ('mismatch_sing', 7): 13.268112182617188,
  ('match_plural', 2): 21.961458206176758,
  ('match_plural', 3): 9.791436195373535,
  ('match_plural', 4): 1.963034749031067,
  ('match_plural', 5): 20.598665237426758,
  ('match_plural', 6): 15.14428424835205,
  ('match_plural', 7): 14.152442932128906,
  ('mismatch_plural', 2): 21.961458206176758,
  ('mismatch_plural', 3): 9.791436195373535,
  ('mismatch_plural', 4): 1.963034749031067,
  ('mismatch_plural', 5): 20.598665237426758,
  ('mismatch_plural', 6): 16.410802841186523,
  ('mismatch_plural', 7): 13.729890823364258,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 19.346508026123047,
  ('match_sing', 3): 22.881088256835938,
  ('match_sing', 4): 1.2651265859603882,
  ('match_sing', 5): 17.840702056884766,
  ('match_sing', 6): 15.925078392028809,
  ('match_sing', 7): 13.838377952575684,
  ('mismatch_sing', 2): 19.346508026123047,
  ('mismatch_sing', 3): 22.881088256835938,
  ('mismatch_sing', 4): 1.2651265859603882,
  ('mismatch_sing', 5): 17.840702056884766,
  ('mismatch_sing', 6): 11.689363479614258,
  ('mismatch_sing', 7): 16.847253799438477,
  ('match_plural', 2): 21.15226936340332,
  ('match_plural', 3): 23.429885864257812,
  ('match_plural', 4): 1.047868251800537,
  ('match_plural', 5): 16.181236267089844,
  ('match_plural', 6): 11.396940231323242,
  ('match_plural', 7): 16.369956970214844,
  ('mismatch_plural', 2): 21.15226936340332,
  ('mismatch_plural', 3): 23.429885864257812,
  ('mismatch_plural', 4): 1.047868251800537,
  ('mismatch_plural', 5): 16.181236267089844,
  ('mismatch_plural', 6): 17.655376434326172,
  ('mismatch_plural', 7): 14.053254127502441,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 19.306894302368164,
  ('match_sing', 3): 23.560800552368164,
  ('match_sing', 4): 2.07466721534729,
  ('match_sing', 5): 15.753016471862793,
  ('match_sing', 6): 15.199499130249023,
  ('match_sing', 7): 14.465932846069336,
  ('mismatch_sing', 2): 19.306894302368164,
  ('mismatch_sing', 3): 23.560800552368164,
  ('mismatch_sing', 4): 2.07466721534729,
  ('mismatch_sing', 5): 15.753016471862793,
  ('mismatch_sing', 6): 13.917813301086426,
  ('mismatch_sing', 7): 15.625304222106934,
  ('match_plural', 2): 17.73427391052246,
  ('match_plural', 3): 24.84090232849121,
  ('match_plural', 4): 1.8232333660125732,
  ('match_plural', 5): 15.552009582519531,
  ('match_plural', 6): 13.421830177307129,
  ('match_plural', 7): 15.888171195983887,
  ('mismatch_plural', 2): 17.73427391052246,
  ('mismatch_plural', 3): 24.84090232849121,
  ('mismatch_plural', 4): 1.8232333660125732,
  ('mismatch_plural', 5): 15.552009582519531,
  ('mismatch_plural', 6): 16.562150955200195,
  ('mismatch_plural', 7): 14.40495491027832,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 20.163795471191406,
  ('match_sing', 3): 12.372801780700684,
  ('match_sing', 4): 2.731375217437744,
  ('match_sing', 5): 16.27208137512207,
  ('match_sing', 6): 4.0816216468811035,
  ('match_sing', 7): 13.233932495117188,
  ('mismatch_sing', 2): 20.163795471191406,
  ('mismatch_sing', 3): 12.372801780700684,
  ('mismatch_sing', 4): 2.731375217437744,
  ('mismatch_sing', 5): 16.27208137512207,
  ('mismatch_sing', 6): 6.249736785888672,
  ('mismatch_sing', 7): 12.870022773742676,
  ('match_plural', 2): 19.388900756835938,
  ('match_plural', 3): 14.181730270385742,
  ('match_plural', 4): 2.033146381378174,
  ('match_plural', 5): 12.041549682617188,
  ('match_plural', 6): 3.6448378562927246,
  ('match_plural', 7): 13.543057441711426,
  ('mismatch_plural', 2): 19.388900756835938,
  ('mismatch_plural', 3): 14.181730270385742,
  ('mismatch_plural', 4): 2.033146381378174,
  ('mismatch_plural', 5): 12.041549682617188,
  ('mismatch_plural', 6): 8.48691177368164,
  ('mismatch_plural', 7): 13.902458190917969,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 21.338682174682617,
  ('match_sing', 3): 11.319145202636719,
  ('match_sing', 4): 0.8702470660209656,
  ('match_sing', 5): 18.953359603881836,
  ('match_sing', 6): 6.512760162353516,
  ('match_sing', 7): 12.702042579650879,
  ('mismatch_sing', 2): 21.338682174682617,
  ('mismatch_sing', 3): 11.319145202636719,
  ('mismatch_sing', 4): 0.8702470660209656,
  ('mismatch_sing', 5): 18.953359603881836,
  ('mismatch_sing', 6): 7.757705211639404,
  ('mismatch_sing', 7): 12.249512672424316,
  ('match_plural', 2): 20.91643714904785,
  ('match_plural', 3): 12.713462829589844,
  ('match_plural', 4): 1.1659976243972778,
  ('match_plural', 5): 15.180723190307617,
  ('match_plural', 6): 5.872315883636475,
  ('match_plural', 7): 11.041028022766113,
  ('mismatch_plural', 2): 20.91643714904785,
  ('mismatch_plural', 3): 12.713462829589844,
  ('mismatch_plural', 4): 1.1659976243972778,
  ('mismatch_plural', 5): 15.180723190307617,
  ('mismatch_plural', 6): 7.291858196258545,
  ('mismatch_plural', 7): 11.472134590148926,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 20.943761825561523,
  ('match_sing', 3): 15.429859161376953,
  ('match_sing', 4): 1.2307214736938477,
  ('match_sing', 5): 17.31743621826172,
  ('match_sing', 6): 4.309698581695557,
  ('match_sing', 7): 13.258875846862793,
  ('mismatch_sing', 2): 20.943761825561523,
  ('mismatch_sing', 3): 15.429859161376953,
  ('mismatch_sing', 4): 1.2307214736938477,
  ('mismatch_sing', 5): 17.31743621826172,
  ('mismatch_sing', 6): 7.546175003051758,
  ('mismatch_sing', 7): 13.222111701965332,
  ('match_plural', 2): 21.368114471435547,
  ('match_plural', 3): 14.886149406433105,
  ('match_plural', 4): 0.8126909732818604,
  ('match_plural', 5): 18.673805236816406,
  ('match_plural', 6): 5.49315071105957,
  ('match_plural', 7): 13.542439460754395,
  ('mismatch_plural', 2): 21.368114471435547,
  ('mismatch_plural', 3): 14.886149406433105,
  ('mismatch_plural', 4): 0.8126909732818604,
  ('mismatch_plural', 5): 18.673805236816406,
  ('mismatch_plural', 6): 7.234429359436035,
  ('mismatch_plural', 7): 13.081379890441895,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 23.061195373535156,
  ('match_sing', 3): 14.948935508728027,
  ('match_sing', 4): 1.4937647581100464,
  ('match_sing', 5): 21.481618881225586,
  ('match_sing', 6): 6.636665344238281,
  ('match_sing', 7): 12.327584266662598,
  ('mismatch_sing', 2): 23.061195373535156,
  ('mismatch_sing', 3): 14.948935508728027,
  ('mismatch_sing', 4): 1.4937647581100464,
  ('mismatch_sing', 5): 21.481618881225586,
  ('mismatch_sing', 6): 7.331475257873535,
  ('mismatch_sing', 7): 11.671815872192383,
  ('match_plural', 2): 23.972415924072266,
  ('match_plural', 3): 15.641358375549316,
  ('match_plural', 4): 1.8887864351272583,
  ('match_plural', 5): 14.906624794006348,
  ('match_plural', 6): 7.361420631408691,
  ('match_plural', 7): 12.631499290466309,
  ('mismatch_plural', 2): 23.972415924072266,
  ('mismatch_plural', 3): 15.641358375549316,
  ('mismatch_plural', 4): 1.8887864351272583,
  ('mismatch_plural', 5): 14.906624794006348,
  ('mismatch_plural', 6): 8.402728080749512,
  ('mismatch_plural', 7): 12.563852310180664,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 20.668676376342773,
  ('match_sing', 3): 16.107988357543945,
  ('match_sing', 4): 0.558175802230835,
  ('match_sing', 5): 18.4233341217041,
  ('match_sing', 6): 5.038350582122803,
  ('match_sing', 7): 12.553362846374512,
  ('mismatch_sing', 2): 20.668676376342773,
  ('mismatch_sing', 3): 16.107988357543945,
  ('mismatch_sing', 4): 0.558175802230835,
  ('mismatch_sing', 5): 18.4233341217041,
  ('mismatch_sing', 6): 7.6892499923706055,
  ('mismatch_sing', 7): 12.433029174804688,
  ('match_plural', 2): 22.96670150756836,
  ('match_plural', 3): 17.146020889282227,
  ('match_plural', 4): 0.4847917854785919,
  ('match_plural', 5): 15.54340934753418,
  ('match_plural', 6): 10.763480186462402,
  ('match_plural', 7): 19.160091400146484,
  ('mismatch_plural', 2): 22.96670150756836,
  ('mismatch_plural', 3): 17.146020889282227,
  ('mismatch_plural', 4): 0.4847917854785919,
  ('mismatch_plural', 5): 15.54340934753418,
  ('mismatch_plural', 6): 9.162352561950684,
  ('mismatch_plural', 7): 19.464683532714844,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 25.069677352905273,
  ('match_sing', 3): 16.605314254760742,
  ('match_sing', 4): 1.9719878435134888,
  ('match_sing', 5): 16.608613967895508,
  ('match_sing', 6): 4.200103759765625,
  ('match_sing', 7): 12.442691802978516,
  ('mismatch_sing', 2): 25.069677352905273,
  ('mismatch_sing', 3): 16.605314254760742,
  ('mismatch_sing', 4): 1.9719878435134888,
  ('mismatch_sing', 5): 16.608613967895508,
  ('mismatch_sing', 6): 6.336711883544922,
  ('mismatch_sing', 7): 12.052306175231934,
  ('match_plural', 2): 25.408782958984375,
  ('match_plural', 3): 21.057315826416016,
  ('match_plural', 4): 1.5175009965896606,
  ('match_plural', 5): 13.802252769470215,
  ('match_plural', 6): 2.427530527114868,
  ('match_plural', 7): 11.527287483215332,
  ('mismatch_plural', 2): 25.408782958984375,
  ('mismatch_plural', 3): 21.057315826416016,
  ('mismatch_plural', 4): 1.5175009965896606,
  ('mismatch_plural', 5): 13.802252769470215,
  ('mismatch_plural', 6): 7.964106559753418,
  ('mismatch_plural', 7): 11.077751159667969,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 22.02299690246582,
  ('match_sing', 3): 16.23299217224121,
  ('match_sing', 4): 1.827444314956665,
  ('match_sing', 5): 16.323577880859375,
  ('match_sing', 6): 4.156154632568359,
  ('match_sing', 7): 13.929503440856934,
  ('mismatch_sing', 2): 22.02299690246582,
  ('mismatch_sing', 3): 16.23299217224121,
  ('mismatch_sing', 4): 1.827444314956665,
  ('mismatch_sing', 5): 16.323577880859375,
  ('mismatch_sing', 6): 5.957536697387695,
  ('mismatch_sing', 7): 13.090185165405273,
  ('match_plural', 2): 21.8836727142334,
  ('match_plural', 3): 16.719911575317383,
  ('match_plural', 4): 1.9564266204833984,
  ('match_plural', 5): 13.684623718261719,
  ('match_plural', 6): 3.0565035343170166,
  ('match_plural', 7): 13.592927932739258,
  ('mismatch_plural', 2): 21.8836727142334,
  ('mismatch_plural', 3): 16.719911575317383,
  ('mismatch_plural', 4): 1.9564266204833984,
  ('mismatch_plural', 5): 13.684623718261719,
  ('mismatch_plural', 6): 7.054007530212402,
  ('mismatch_plural', 7): 14.505009651184082,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 21.61040496826172,
  ('match_sing', 3): 11.587929725646973,
  ('match_sing', 4): 0.991382896900177,
  ('match_sing', 5): 18.6159725189209,
  ('match_sing', 6): 14.2048921585083,
  ('match_sing', 7): 18.316404342651367,
  ('mismatch_sing', 2): 21.61040496826172,
  ('mismatch_sing', 3): 11.587929725646973,
  ('mismatch_sing', 4): 0.991382896900177,
  ('mismatch_sing', 5): 18.6159725189209,
  ('mismatch_sing', 6): 14.482364654541016,
  ('mismatch_sing', 7): 20.014671325683594,
  ('match_plural', 2): 21.661741256713867,
  ('match_plural', 3): 11.43416976928711,
  ('match_plural', 4): 1.1338534355163574,
  ('match_plural', 5): 15.92543888092041,
  ('match_plural', 6): 14.368210792541504,
  ('match_plural', 7): 18.950557708740234,
  ('mismatch_plural', 2): 21.661741256713867,
  ('mismatch_plural', 3): 11.43416976928711,
  ('mismatch_plural', 4): 1.1338534355163574,
  ('mismatch_plural', 5): 15.92543888092041,
  ('mismatch_plural', 6): 15.84195613861084,
  ('mismatch_plural', 7): 18.186222076416016,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 21.63022232055664,
  ('match_sing', 3): 15.419702529907227,
  ('match_sing', 4): 1.9735808372497559,
  ('match_sing', 5): 16.51506233215332,
  ('match_sing', 6): 14.815573692321777,
  ('match_sing', 7): 11.567441940307617,
  ('mismatch_sing', 2): 21.63022232055664,
  ('mismatch_sing', 3): 15.419702529907227,
  ('mismatch_sing', 4): 1.9735808372497559,
  ('mismatch_sing', 5): 16.51506233215332,
  ('mismatch_sing', 6): 16.676937103271484,
  ('mismatch_sing', 7): 9.196702003479004,
  ('match_plural', 2): 22.26809310913086,
  ('match_plural', 3): 14.303712844848633,
  ('match_plural', 4): 1.491896152496338,
  ('match_plural', 5): 16.902368545532227,
  ('match_plural', 6): 16.91156768798828,
  ('match_plural', 7): 7.787027835845947,
  ('mismatch_plural', 2): 22.26809310913086,
  ('mismatch_plural', 3): 14.303712844848633,
  ('mismatch_plural', 4): 1.491896152496338,
  ('mismatch_plural', 5): 16.902368545532227,
  ('mismatch_plural', 6): 17.316545486450195,
  ('mismatch_plural', 7): 10.844969749450684,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 19.29212760925293,
  ('match_sing', 3): 16.56344223022461,
  ('match_sing', 4): 1.950209617614746,
  ('match_sing', 5): 20.407838821411133,
  ('match_sing', 6): 13.895942687988281,
  ('match_sing', 7): 11.518522262573242,
  ('mismatch_sing', 2): 19.29212760925293,
  ('mismatch_sing', 3): 16.56344223022461,
  ('mismatch_sing', 4): 1.950209617614746,
  ('mismatch_sing', 5): 20.407838821411133,
  ('mismatch_sing', 6): 13.81969165802002,
  ('mismatch_sing', 7): 13.231416702270508,
  ('match_plural', 2): 20.827131271362305,
  ('match_plural', 3): 14.831899642944336,
  ('match_plural', 4): 1.762074589729309,
  ('match_plural', 5): 19.217327117919922,
  ('match_plural', 6): 13.957934379577637,
  ('match_plural', 7): 18.94022560119629,
  ('mismatch_plural', 2): 20.827131271362305,
  ('mismatch_plural', 3): 14.831899642944336,
  ('mismatch_plural', 4): 1.762074589729309,
  ('mismatch_plural', 5): 19.217327117919922,
  ('mismatch_plural', 6): 15.85820198059082,
  ('mismatch_plural', 7): 18.488245010375977,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 26.573909759521484,
  ('match_sing', 3): 17.06254005432129,
  ('match_sing', 4): 0.6520307064056396,
  ('match_sing', 5): 18.941768646240234,
  ('match_sing', 6): 17.081558227539062,
  ('match_sing', 7): 12.291244506835938,
  ('mismatch_sing', 2): 26.573909759521484,
  ('mismatch_sing', 3): 17.06254005432129,
  ('mismatch_sing', 4): 0.6520307064056396,
  ('mismatch_sing', 5): 18.941768646240234,
  ('mismatch_sing', 6): 15.259037971496582,
  ('mismatch_sing', 7): 13.26732349395752,
  ('match_plural', 2): 27.312984466552734,
  ('match_plural', 3): 18.305089950561523,
  ('match_plural', 4): 0.7322041988372803,
  ('match_plural', 5): 15.809515953063965,
  ('match_plural', 6): 15.497516632080078,
  ('match_plural', 7): 16.070693969726562,
  ('mismatch_plural', 2): 27.312984466552734,
  ('mismatch_plural', 3): 18.305089950561523,
  ('mismatch_plural', 4): 0.7322041988372803,
  ('mismatch_plural', 5): 15.809515953063965,
  ('mismatch_plural', 6): 20.390958786010742,
  ('mismatch_plural', 7): 18.026151657104492,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 20.201005935668945,
  ('match_sing', 3): 22.06728744506836,
  ('match_sing', 4): 1.830654501914978,
  ('match_sing', 5): 13.537979125976562,
  ('match_sing', 6): 16.623699188232422,
  ('match_sing', 7): 16.208240509033203,
  ('mismatch_sing', 2): 20.201005935668945,
  ('mismatch_sing', 3): 22.06728744506836,
  ('mismatch_sing', 4): 1.830654501914978,
  ('mismatch_sing', 5): 13.537979125976562,
  ('mismatch_sing', 6): 16.61302375793457,
  ('mismatch_sing', 7): 17.073265075683594,
  ('match_plural', 2): 25.514707565307617,
  ('match_plural', 3): 22.854589462280273,
  ('match_plural', 4): 1.5180625915527344,
  ('match_plural', 5): 14.939571380615234,
  ('match_plural', 6): 15.666622161865234,
  ('match_plural', 7): 16.833984375,
  ('mismatch_plural', 2): 25.514707565307617,
  ('mismatch_plural', 3): 22.854589462280273,
  ('mismatch_plural', 4): 1.5180625915527344,
  ('mismatch_plural', 5): 14.939571380615234,
  ('mismatch_plural', 6): 17.19580841064453,
  ('mismatch_plural', 7): 15.820122718811035,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0},
 {('match_sing', 2): 18.50815200805664,
  ('match_sing', 3): 22.332265853881836,
  ('match_sing', 4): 2.612340211868286,
  ('match_sing', 5): 14.414167404174805,
  ('match_sing', 6): 4.902920722961426,
  ('match_sing', 7): 13.331064224243164,
  ('mismatch_sing', 2): 18.50815200805664,
  ('mismatch_sing', 3): 22.332265853881836,
  ('mismatch_sing', 4): 2.612340211868286,
  ('mismatch_sing', 5): 14.414167404174805,
  ('mismatch_sing', 6): 6.169538974761963,
  ('mismatch_sing', 7): 12.702722549438477,
  ('match_plural', 2): 20.167997360229492,
  ('match_plural', 3): 16.284507751464844,
  ('match_plural', 4): 2.6351826190948486,
  ('match_plural', 5): 14.197392463684082,
  ('match_plural', 6): 3.4608843326568604,
  ('match_plural', 7): 12.603095054626465,
  ('mismatch_plural', 2): 20.167997360229492,
  ('mismatch_plural', 3): 16.284507751464844,
  ('mismatch_plural', 4): 2.6351826190948486,
  ('mismatch_plural', 5): 14.197392463684082,
  ('mismatch_plural', 6): 8.652911186218262,
  ('mismatch_plural', 7): 13.079071044921875,
  ('match_sing', 1): 0.0,
  ('mismatch_sing', 1): 0.0,
  ('match_plural', 1): 0.0,
  ('mismatch_plural', 1): 0.0}]
}


# Scores for distilgpt2 computed with the reference implementation
REFERENCE_DISTILGPT2_SCORES = {
    "center_embed": 0.964286,
    "center_embed_mod": 0.928571,
    "cleft": 1.000000,
    "cleft_modifier": 0.725000,
    "fgd_hierarchy": 0.000000,
    "fgd_object": 0.875000,
    "fgd_pp": 0.875000,
    "fgd_subject": 0.541667,
    "mvrr": 0.821429,
    "mvrr_mod": 0.785714,
    "npi_orc_any": 0.026316,
    "npi_orc_ever": 0.026316,
    "npi_src_any": 0.000000,
    "npi_src_ever": 0.000000,
    "npz_ambig": 0.750000,
    "npz_ambig_mod": 0.583334,
    "npz_obj": 0.916667,
    "npz_obj_mod": 0.875000,
    "number_orc": 0.263158,
    "number_prep": 0.578947,
    "number_src": 0.789474,
    "reflexive_orc_fem": 0.000000,
    "reflexive_orc_masc": 0.368421,
    "reflexive_prep_fem": 0.105263,
    "reflexive_prep_masc": 0.473684,
    "reflexive_src_fem": 0.157895,
    "reflexive_src_masc": 0.526316,
    "subordination": 0.217391,
    "subordination_orc-orc": 0.956522,
    "subordination_pp-pp": 0.478261,
    "subordination_src-src": 0.565217,
}


@pytest.fixture(scope="session")
def distilgpt2():
  return HuggingfaceSubject(model_id="distilgpt2", region_layer_mapping={})


@pytest.mark.parametrize("suite", REFERENCE_DISTILGPT2_REGION_TOTALS.keys())
def test_region_totals_match(distilgpt2, suite: str):
    """
    The region-level surprisals computed on the subordination_src-src
    test suite should match those of the reference implementation.
    """

    benchmark = SyntaxGymSingleTSE(suite)
    subject = distilgpt2

    expected: List[Dict[str, float]] = REFERENCE_DISTILGPT2_REGION_TOTALS[suite][:6]
    # Reference may be a subset of actual items. Truncate as necessary.
    benchmark.suite.items = benchmark.suite.items[:len(expected)]

    actual = benchmark.get_region_totals(subject)

    keys = actual[0].keys()
    assert set(keys) == set(expected[0].keys())

    # Convert to dataframe for easy comparison + easy visualization of mismatches
    def make_item_df(region_totals):
        return pd.Series(region_totals).unstack() \
            .rename_axis(index="condition", columns="region_number")
    actual_df = pd.concat([make_item_df(item_totals) for item_totals in actual],
                          names=["item_number"],
                          keys=np.arange(len(actual)) + 1).astype(float)
    expected_df = pd.concat([make_item_df(item_totals) for item_totals in expected],
                            names=["item_number"],
                            keys=np.arange(len(actual)) + 1).astype(float)
    pprint((expected_df - actual_df).round(3))
    pd.testing.assert_frame_equal(actual_df, expected_df, atol=1e-3, check_exact=False)


def test_syntaxgym2020_data():
    from brainscore_language.benchmarks.syntaxgym import SyntaxGym2020

    assert len(SyntaxGym2020().sub_benchmarks) == 31


@pytest.mark.parametrize("suite_ref", REFERENCE_DISTILGPT2_SCORES.keys())
def test_suite_accuracies(distilgpt2: HuggingfaceSubject, suite_ref: str):
    """
    Compare distilgpt2 suite accuracies with those of the reference implementation.
    """
    tse = SyntaxGymSingleTSE(suite_ref)
    accuracy = tse(distilgpt2)
    expected_accuracy = REFERENCE_DISTILGPT2_SCORES[suite_ref]
    np.testing.assert_almost_equal(float(accuracy), expected_accuracy, decimal=3)